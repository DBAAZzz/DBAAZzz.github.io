---
title: 组合模式
author: DBAAZzz
date: 2025/11/30 23:50
categories:
  - 面试
tags:
  - 设计模式
  - 组合模式
---

## 组合模式

**组合模式**（Composite Pattern）将对象组合成树形结构以表示“部分-整体”的层次结构。组合模式使得用户对单个对象和组合对象的使用具有一致性。

核心思想：

- **树形结构**：处理递归结构（如文件夹/文件，菜单/子菜单）。
- **统一对待**：客户端代码可以一致地处理简单元素和复杂元素，无需区分。

## 基本实现

以文件夹和文件为例：

```javascript
// 抽象构件
class Entry {
  getName() {
    throw new Error('Method not implemented')
  }
  getSize() {
    throw new Error('Method not implemented')
  }
  add(entry) {
    throw new Error('Method not implemented')
  }
}

// 叶子节点：文件
class File extends Entry {
  constructor(name, size) {
    super()
    this.name = name
    this.size = size
  }
  getName() {
    return this.name
  }
  getSize() {
    return this.size
  }
  add() {
    throw new Error('File cannot add entry')
  }
}

// 容器节点：文件夹
class Folder extends Entry {
  constructor(name) {
    super()
    this.name = name
    this.children = []
  }
  getName() {
    return this.name
  }
  add(entry) {
    this.children.push(entry)
  }
  // 递归计算大小
  getSize() {
    return this.children.reduce((acc, child) => acc + child.getSize(), 0)
  }
}

// 使用
const root = new Folder('root')
const bin = new Folder('bin')
const tmp = new Folder('tmp')
const file1 = new File('vi', 1000)
const file2 = new File('latex', 2000)

root.add(bin)
root.add(tmp)
bin.add(file1)
bin.add(file2)

console.log(root.getSize()) // 3000
```

## 前端生态中的应用

### 1. DOM 树

DOM 是最典型的组合模式。

- `HTMLElement` 是容器（可以包含子元素）。
- `TextNode` 是叶子（不能包含子元素）。
- 但它们都继承自 `Node`，都有 `appendChild`（虽然 TextNode 调用会报错）、`removeChild` 等方法，浏览器渲染引擎可以统一遍历它们。

### 2. 虚拟 DOM (Virtual DOM)

React 或 Vue 的 VNode 树也是组合模式。

```javascript
const vnode = {
  tag: 'div',
  children: [
    { tag: 'h1', children: ['Title'] },
    { tag: 'p', children: ['Content'] },
  ],
}
```

渲染引擎递归处理这个树，无论是处理 `div` 还是 `p`，逻辑都是相似的。

### 3. UI 组件树

在 React/Vue 开发中，组件套组件，形成组件树。父组件通常不需要知道子组件的具体实现，只需要把它们当作 `children` 渲染出来。

```jsx
<Card>
  <Avatar />
  <Text>User Name</Text>
</Card>
```

`Card` 组件作为容器，统一管理内部布局，而不需要关心内部具体是 `Avatar` 还是 `Text`。

## 组合模式的优势

- **简化客户端代码**：客户端不需要区分是叶子节点还是容器节点。
- **易于扩展**：增加新的节点类型很容易。
- **符合开闭原则**。

## 面试重点

**"如何遍历一个 DOM 树？"**

这考察的是对树形结构的遍历算法（深度优先 DFS 或 广度优先 BFS）。

```javascript
// 深度优先遍历 DOM
function traverse(node) {
  console.log(node.tagName)
  const children = node.children
  for (let i = 0; i < children.length; i++) {
    traverse(children[i])
  }
}
```

**"组合模式在前端路由中的应用？"**

Vue Router 或 React Router 的路由配置通常是嵌套数组，这也是组合模式的体现。路由守卫、路径匹配等逻辑会递归地在路由树上执行。
