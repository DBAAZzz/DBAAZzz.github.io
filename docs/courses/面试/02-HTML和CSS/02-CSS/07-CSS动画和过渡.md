---
title: CSS åŠ¨ç”»ä¸è¿‡æ¸¡æ·±åº¦è§£æ
author: DBAAZzz
date: 2025/12/04 00:40
categories:
  - é¢è¯•
tags:
  - CSS
  - Animation
  - Performance
---

# CSS åŠ¨ç”»ä¸è¿‡æ¸¡æ·±åº¦è§£æ

> ğŸ’¡ **é¢è¯•é‡ç‚¹**ï¼šCSS åŠ¨ç”»åœ¨é¢è¯•ä¸­ä¸»è¦è€ƒå¯Ÿ**æ€§èƒ½ä¼˜åŒ–**ï¼ˆå¦‚ä½•ä¸è§¦å‘é‡æ’é‡ç»˜ï¼‰ã€**Transition ä¸ Animation çš„åŒºåˆ«**ã€**JS åŠ¨ç”»ä¸ CSS åŠ¨ç”»çš„é€‰æ‹©**ä»¥åŠå¤æ‚çš„åŠ¨ç”»æ§åˆ¶å±æ€§ï¼ˆå¦‚ `animation-fill-mode`ï¼‰ã€‚

## ä¸€ã€Transition (è¿‡æ¸¡)

`transition` å…è®¸ CSS çš„å±æ€§å€¼åœ¨ä¸€å®šçš„æ—¶é—´åŒºé—´å†…å¹³æ»‘åœ°è¿‡æ¸¡ã€‚

å®ƒéœ€è¦ä¸€ä¸ªè§¦å‘æ¡ä»¶ï¼ˆå¦‚ `:hover`ã€`.class` å˜åŒ–ã€JS ä¿®æ”¹ styleï¼‰ã€‚

### 1. æ ¸å¿ƒå±æ€§

`transition` æ˜¯ç®€å†™å±æ€§ï¼š`transition: property duration timing-function delay;`

- **property**: æŒ‡å®šè¦è¿‡æ¸¡çš„å±æ€§ï¼ˆ`all` æˆ–å…·ä½“å±æ€§å¦‚ `width`, `transform`ï¼‰ã€‚
- **duration**: æŒç»­æ—¶é—´ï¼ˆ`0.3s`, `300ms`ï¼‰ã€‚
- **timing-function**: ç¼“åŠ¨å‡½æ•°ï¼ˆ`linear`, `ease`, `cubic-bezier`ï¼‰ã€‚
- **delay**: å»¶è¿Ÿæ—¶é—´ã€‚

### 2. å¸¸è§é™·é˜±ä¸é¢è¯•ç‚¹

- **å“ªäº›å±æ€§ä¸èƒ½è¿‡æ¸¡ï¼Ÿ**
  - `display: none` åˆ° `display: block` **æ— æ³•**è¿‡æ¸¡ï¼ˆå› ä¸º `display` ä¸æ˜¯å¯åŠ¨ç”»å±æ€§ï¼‰ã€‚
  - `height: 0` åˆ° `height: auto` **æ— æ³•**è¿‡æ¸¡ï¼ˆå› ä¸º `auto` ä¸æ˜¯æ•°å€¼ï¼Œæµè§ˆå™¨ä¸çŸ¥é“ç»ˆç‚¹æ˜¯å¤šå°‘ï¼‰ã€‚
    - _è§£å†³æ–¹æ¡ˆ_ï¼šä½¿ç”¨ `max-height`ï¼ˆè®¾ç½®ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å€¼ï¼‰æˆ– JS è·å–é«˜åº¦ååŠ¨æ€è®¾ç½®ã€‚
- **Hardware Acceleration (ç¡¬ä»¶åŠ é€Ÿ)**
  - å°½é‡è¿‡æ¸¡ `transform` å’Œ `opacity`ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥ç”± GPU åˆæˆï¼Œ**ä¸ä¼šè§¦å‘ Layout (é‡æ’) å’Œ Paint (é‡ç»˜)**ï¼Œåªè§¦å‘ Composite (åˆæˆ)ã€‚

---

## äºŒã€Animation (å…³é”®å¸§åŠ¨ç”»)

`animation` ä¸éœ€è¦å¤–éƒ¨è§¦å‘ï¼Œå¯ä»¥è‡ªåŠ¨å…è®¸ï¼Œå¹¶ä¸”æ§åˆ¶æ›´ç²¾ç»†ï¼ˆå…³é”®å¸§ï¼‰ã€‚

### 1. @keyframes è§„åˆ™

```css
@keyframes slide-in {
  0% {
    transform: translateX(-100%);
    opacity: 0;
  }
  100% {
    transform: translateX(0);
    opacity: 1;
  }
}
```

### 2. æ ¸å¿ƒå±æ€§è¯¦è§£

`animation` ç®€å†™åŒ…æ‹¬ï¼š
`animation: name duration timing-function delay iteration-count direction fill-mode play-state;`

#### é‡ç‚¹è€ƒå¯Ÿå±æ€§ï¼š

- **`animation-fill-mode`**: è§„å®šåŠ¨ç”»åœ¨æ’­æ”¾ä¹‹å‰æˆ–ä¹‹åï¼Œå…¶åŠ¨ç”»æ•ˆæœæ˜¯å¦å¯è§ã€‚

  - `none`: é»˜è®¤å€¼ï¼ŒåŠ¨ç”»ç»“æŸåæ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚
  - `forwards`: **(å¸¸ç”¨)** åŠ¨ç”»ç»“æŸååœç•™åœ¨æœ€åä¸€å¸§ã€‚
  - `backwards`: åœ¨ `animation-delay` æœŸé—´ï¼Œåº”ç”¨ç¬¬ä¸€å¸§çš„æ ·å¼ã€‚
  - `both`: åŒæ—¶å…·å¤‡ forwards å’Œ backwards çš„ç‰¹æ€§ã€‚

- **`animation-direction`**:

  - `normal`: æ­£å‘æ’­æ”¾ã€‚
  - `reverse`: åå‘æ’­æ”¾ã€‚
  - `alternate`: å¥‡æ•°æ¬¡æ­£å‘ï¼Œå¶æ•°æ¬¡åå‘ï¼ˆä¹’ä¹“æ•ˆæœï¼‰ã€‚

- **`animation-play-state`**:
  - `running`: æ’­æ”¾ã€‚
  - `paused`: æš‚åœã€‚**(å¸¸ç”¨äº JS æ§åˆ¶åŠ¨ç”»æš‚åœ)**

---

## ä¸‰ã€Transition vs Animation

| ç‰¹æ€§         | Transition (è¿‡æ¸¡)                   | Animation (åŠ¨ç”»)                       |
| :----------- | :---------------------------------- | :------------------------------------- |
| **è§¦å‘æ–¹å¼** | éœ€è¦çŠ¶æ€å˜åŒ–è§¦å‘ (hover, class, JS) | è‡ªåŠ¨è¿è¡Œï¼Œæˆ–é€šè¿‡ç±»åæ·»åŠ è¿è¡Œ           |
| **æ§åˆ¶ç²’åº¦** | åªæœ‰å¼€å§‹å’Œç»“æŸä¸¤å¸§ (A -> B)         | å¯ä»¥å®šä¹‰ä»»æ„ä¸­é—´å¸§ (0% -> 50% -> 100%) |
| **å¾ªç¯**     | ä¸èƒ½å¾ªç¯                            | å¯ä»¥è®¾ç½® `iteration-count` å¾ªç¯æ’­æ”¾    |
| **å¤æ‚æ€§**   | ç®€å•ï¼Œé€‚åˆç®€å•çš„ UI äº¤äº’            | å¤æ‚ï¼Œé€‚åˆè¿ç»­åŠ¨æ•ˆæˆ–åŠ è½½åŠ¨ç”»           |
| **JS äº¤äº’**  | è¾ƒå¼±                                | è¾ƒå¼º (`play-state`, äº‹ä»¶ç›‘å¬)          |

---

## å››ã€æ€§èƒ½ä¼˜åŒ– (é¢è¯•é«˜é¢‘)

### 1. é¿å… Reflow (é‡æ’) å’Œ Repaint (é‡ç»˜)

æµè§ˆå™¨æ¸²æŸ“æµç¨‹ï¼š`Layout` (å¸ƒå±€/é‡æ’) -> `Paint` (ç»˜åˆ¶) -> `Composite` (åˆæˆ)ã€‚

- **é«˜æ€§èƒ½åŠ¨ç”»**: ä¿®æ”¹ `transform` (ä½ç§»ã€ç¼©æ”¾ã€æ—‹è½¬) å’Œ `opacity`ã€‚
  - è¿™äº›å±æ€§çš„å˜åŒ–å‘ç”Ÿåœ¨ Composite é˜¶æ®µï¼Œä¸å½±å“å¸ƒå±€ï¼Œç›´æ¥ç”± GPU å¤„ç†ã€‚
- **ä½æ€§èƒ½åŠ¨ç”»**: ä¿®æ”¹ `width`, `height`, `margin`, `top`, `left`ã€‚
  - è¿™äº›å±æ€§ä¼šè§¦å‘ Layoutï¼Œå¯¼è‡´æµè§ˆå™¨é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ ä½ç½®ï¼Œæ¶ˆè€— CPUã€‚

### 2. å¼€å¯ç¡¬ä»¶åŠ é€Ÿ

å¼ºåˆ¶æµè§ˆå™¨ä¸ºå…ƒç´ åˆ›å»ºç‹¬ç«‹çš„åˆæˆå±‚ï¼ˆCompositing Layerï¼‰ï¼Œäº¤ç»™ GPU æ¸²æŸ“ã€‚

```css
.accelerated {
  /* ç°ä»£æµè§ˆå™¨æ¨è */
  will-change: transform, opacity;

  /* æ—§ç‰ˆ Hack å†™æ³• */
  transform: translateZ(0);
}
```

> âš ï¸ **æ³¨æ„**: ä¸è¦æ»¥ç”¨ `will-change`ï¼Œè¿‡å¤šçš„åˆæˆå±‚ä¼šå ç”¨å¤§é‡æ˜¾å­˜ï¼Œå¯¼è‡´é¡µé¢å´©æºƒæˆ–åè€Œå˜å¡ã€‚ç”¨å®Œåæœ€å¥½é€šè¿‡ JS ç§»é™¤ã€‚

---

## äº”ã€CSS åŠ¨ç”» vs JS åŠ¨ç”»

### 1. åŒºåˆ«

| ç»´åº¦       | CSS åŠ¨ç”»                                       | JS åŠ¨ç”» (requestAnimationFrame)                          |
| :--------- | :--------------------------------------------- | :------------------------------------------------------- |
| **ç”±äº**   | æµè§ˆå™¨åŸç”Ÿä¼˜åŒ–ï¼Œæ€§èƒ½é€šå¸¸æ›´å¥½ï¼ˆå°¤å…¶æ˜¯ç§»åŠ¨ç«¯ï¼‰ã€‚ | çµæ´»ï¼Œé€»è¾‘æ§åˆ¶èƒ½åŠ›å¼ºã€‚                                   |
| **å¤æ‚åº¦** | é€‚åˆç®€å•çš„ UI è¿‡æ¸¡å’Œå¾ªç¯æ•ˆæœã€‚                 | é€‚åˆå¤æ‚çš„ç‰©ç†æ•ˆæœï¼ˆå¦‚é‡åŠ›ã€ç¢°æ’ï¼‰ã€æ¸¸æˆé€»è¾‘ã€è§†å·®æ»šåŠ¨ã€‚ |
| **ä¸»çº¿ç¨‹** | å¦‚æœåªç”¨ transform/opacityï¼Œä¸å ç”¨ä¸»çº¿ç¨‹ã€‚     | è¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼Œè‹¥ JS é˜»å¡ï¼ŒåŠ¨ç”»ä¼šå¡é¡¿ã€‚                   |
| **å…¼å®¹æ€§** | æå¥½ã€‚                                         | æå¥½ (é…åˆ Polyfill)ã€‚                                   |

### 2. requestAnimationFrame (rAF)

JS åŠ¨ç”»çš„æ ¸å¿ƒ APIã€‚ç›¸æ¯” `setInterval` / `setTimeout`ï¼Œ`rAF` çš„ä¼˜åŠ¿åœ¨äºï¼š

1.  **å¸§ç‡åŒæ­¥**: æµè§ˆå™¨è‡ªåŠ¨åœ¨ä¸‹ä¸€æ¬¡é‡ç»˜å‰è°ƒç”¨ï¼Œé€šå¸¸æ˜¯ 60fpsï¼Œä¸ä¼šå‡ºç°æ‰å¸§æˆ–è¿‡å¿«ã€‚
2.  **èŠ‚èƒ½**: å½“é¡µé¢å¤„äºåå°æˆ–ä¸å¯è§æ—¶ï¼ŒrAF ä¼šè‡ªåŠ¨æš‚åœï¼ŒèŠ‚çœ CPU å’Œç”µæ± ã€‚

```javascript
function animate() {
  element.style.transform = `translateX(${pos}px)`;
  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);
```

---

## å…­ã€å®æˆ˜åœºæ™¯é¢˜

### Q: å¦‚ä½•å®ç°ä¸€ä¸ªâ€œæ‰“å­—æœºâ€æ•ˆæœï¼Ÿ

åˆ©ç”¨ `steps()` ç¼“åŠ¨å‡½æ•°ã€‚`steps(N)` ä¼šå°†è¿‡æ¸¡åˆ†å‰²æˆ N æ®µç¦»æ•£çš„é˜¶è·ƒã€‚

```css
.typing {
  width: 0;
  white-space: nowrap;
  overflow: hidden;
  border-right: 2px solid black; /* å…‰æ ‡ */
  animation: typing 3s steps(10), /* å‡è®¾æœ‰ 10 ä¸ªå­—ç¬¦ */ blink 0.5s step-end
      infinite alternate;
}

@keyframes typing {
  from {
    width: 0;
  }
  to {
    width: 10ch;
  } /* ch æ˜¯ '0' çš„å®½åº¦ */
}
```

### Q: ä¹Ÿå¯ä»¥ä½¿ç”¨ JS ç›‘å¬åŠ¨ç”»ç»“æŸå—ï¼Ÿ

å¯ä»¥ã€‚

```javascript
const el = document.querySelector(".box");

// ç›‘å¬è¿‡æ¸¡ç»“æŸ
el.addEventListener("transitionend", () => {
  console.log("Transition ended");
});

// ç›‘å¬åŠ¨ç”»ç»“æŸ
el.addEventListener("animationend", () => {
  console.log("Animation ended");
});
```

_(æ³¨æ„ï¼šå¦‚æœæœ‰å¤šä¸ªå±æ€§åŒæ—¶è¿‡æ¸¡ï¼Œtransitionend ä¼šè§¦å‘å¤šæ¬¡)_
