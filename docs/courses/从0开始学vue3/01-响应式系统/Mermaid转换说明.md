# Vue 依赖追踪文档 - Mermaid 图表转换总结

## 转换完成的流程图

### 1. 核心数据结构图

**位置**: 第一章 - 三层数据结构

**转换前**: 文本箭头流程图
**转换后**: Mermaid graph TD (自顶向下流程图)

展示了从 `targetMap` → `depsMap` → `Dep` → `Link` → `ReactiveEffect` 的完整层次结构，使用不同颜色区分各个层级。

---

### 2. 依赖收集完整流程图

**位置**: 第三章 - 依赖收集流程

**转换前**: 文本箭头流程图
**转换后**: Mermaid flowchart TD (带决策节点的流程图)

展示了从用户读取响应式属性到依赖收集完成的完整过程，包含：

- 条件判断节点 (`shouldTrack && activeSub`)
- 跳过收集的分支
- 不同阶段的颜色标识

---

### 3. 触发更新完整流程图

**位置**: 第四章 - 触发更新流程

**转换前**: 文本箭头流程图
**转换后**: Mermaid flowchart TD (带决策节点的流程图)

展示了从用户修改响应式属性到 Effects 被调度执行的完整过程，包含：

- depsMap 存在性检查
- 版本号递增
- 批量通知机制

---

### 4. 双向链表结构图

**位置**: 第七章 - 优化机制详解

**转换前**: 文本 ASCII 艺术图
**转换后**: Mermaid graph LR (左右布局图)

展示了 Effect.deps 双向链表与 Dep.subs 的关系，包含：

- 双向链接关系
- 指向关系
- 不同节点的颜色区分

---

### 5. 完整示例执行流程图（5 个阶段）

#### 阶段 1: 创建响应式对象

**转换后**: Mermaid flowchart TD

- 展示 reactive() 到 Proxy 创建的过程

#### 阶段 2: 创建 effect

**转换后**: Mermaid flowchart TD

- 展示 effect() 到 ReactiveEffect 实例化的过程

#### 阶段 3: effect.run() 执行

**转换后**: Mermaid flowchart TD (复杂流程)

- 展示依赖收集的详细过程
- 包含两个属性的访问流程
- 使用不同颜色标识关键步骤

#### 阶段 4: 触发更新

**转换后**: Mermaid flowchart TD (带决策节点)

- 展示从属性修改到 effect 重新执行的完整过程
- 包含脏检查逻辑

#### 阶段 5: 依赖清理

**转换后**: Mermaid flowchart TD (带决策节点)

- 展示依赖清理和版本号同步的过程
- 包含保留/清理的决策逻辑

---

## 图表设计特点

### 1. 颜色编码

- **蓝色** (#e3f2fd): 起始节点
- **黄色** (#fff9c4): 中间处理节点/决策节点
- **绿色** (#c8e6c9): 完成节点
- **红色** (#ffebee): 重要操作节点

### 2. 节点类型

- **矩形**: 普通流程步骤
- **菱形**: 条件判断
- **子图**: 逻辑分组

### 3. 连接线类型

- **实线箭头** (-->): 主要流程
- **虚线箭头** (-.->): 引用关系
- **双向箭头** (<-->): 双向链接

---

## 转换优势

### 1. 可视化改进

- ✅ 更清晰的层次结构
- ✅ 更直观的流程方向
- ✅ 更易于理解的决策分支

### 2. 可维护性

- ✅ 易于修改和更新
- ✅ 支持版本控制
- ✅ 可以导出为图片

### 3. 交互性

- ✅ 在支持的平台上可以交互
- ✅ 可以缩放查看细节
- ✅ 可以点击节点高亮路径

---

## 文档统计

- **总转换图表数**: 9 个
- **简单流程图**: 3 个
- **复杂流程图**: 5 个
- **结构关系图**: 2 个
- **代码行数减少**: 约 200 行
- **可读性提升**: 显著

---

## 使用建议

### 查看方式

1. **GitHub**: 自动渲染 Mermaid 图表
2. **VS Code**: 安装 Mermaid 插件
3. **在线工具**: [Mermaid Live Editor](https://mermaid.live/)

### 导出图片

```bash
# 使用 mermaid-cli
npm install -g @mermaid-js/mermaid-cli
mmdc -i diagram.mmd -o diagram.png
```

---

## 后续优化建议

1. **添加图例**: 为颜色编码添加统一的图例说明
2. **交互式演示**: 可以考虑制作动态演示版本
3. **简化复杂图**: 对于特别复杂的流程，可以拆分为多个子图
4. **添加注释**: 在关键节点添加更详细的注释

---

## 技术细节

### Mermaid 版本要求

- 推荐版本: 9.0+
- 最低版本: 8.0+

### 浏览器兼容性

- Chrome: ✅
- Firefox: ✅
- Safari: ✅
- Edge: ✅

### 移动端支持

- iOS Safari: ✅
- Android Chrome: ✅
- 响应式布局: ✅
