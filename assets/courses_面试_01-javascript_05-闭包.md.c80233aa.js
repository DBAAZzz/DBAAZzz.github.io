import{_ as s,o as n,c as a,X as l}from"./chunks/framework.6625828e.js";const C=JSON.parse('{"title":"闭包","description":"","frontmatter":{"title":"闭包","author":"DBAAZzz","date":"2025/11/18 22:34","categories":["面试"],"tags":["闭包"]},"headers":[],"relativePath":"courses/面试/01-javascript/05-闭包.md","filePath":"courses/面试/01-javascript/05-闭包.md","lastUpdated":1763480960000}'),p={name:"courses/面试/01-javascript/05-闭包.md"},o=l(`<h2 id="什么是闭包" tabindex="-1">什么是闭包 <a class="header-anchor" href="#什么是闭包" aria-label="Permalink to &quot;什么是闭包&quot;">​</a></h2><p><strong>闭包</strong>是指函数能够&quot;记住&quot;并访问其词法作用域（定义时的作用域），即使该函数在其词法作用域之外执行。</p><p>本质剖析：</p><ul><li>闭包不是 JavaScript 特有的概念，而是词法作用域（Lexical Scope）的自然结果</li><li>JavaScript 引擎通过作用域链（Scope Chain） 实现闭包：每个函数创建时会保存对其外部作用域的引用</li><li>闭包的内存表现：被闭包引用的变量不会被垃圾回收，形成&quot;内存孤岛&quot;</li></ul><p>闭包的形成条件：</p><ul><li>函数嵌套（内部函数引用外部函数的变量）</li><li>内部函数被返回或以某种方式保存</li><li>外部函数执行完毕后，其作用域链依然被保持</li></ul><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">function</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">outer</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">let</span><span style="color:#ADBAC7;"> count </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">// 外部函数的变量</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">function</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">inner</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#ADBAC7;">    count</span><span style="color:#F47067;">++</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">// 内部函数访问外部变量</span></span>
<span class="line"><span style="color:#ADBAC7;">    console.</span><span style="color:#DCBDFB;">log</span><span style="color:#ADBAC7;">(count)</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> inner</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">counter</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">outer</span><span style="color:#ADBAC7;">() </span><span style="color:#768390;">// outer 执行完毕</span></span>
<span class="line"><span style="color:#DCBDFB;">counter</span><span style="color:#ADBAC7;">() </span><span style="color:#768390;">// 1 - 但 count 变量仍然存在</span></span>
<span class="line"><span style="color:#DCBDFB;">counter</span><span style="color:#ADBAC7;">() </span><span style="color:#768390;">// 2</span></span>
<span class="line"><span style="color:#DCBDFB;">counter</span><span style="color:#ADBAC7;">() </span><span style="color:#768390;">// 3</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">outer</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">count</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 外部函数的变量</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">inner</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">count</span><span style="color:#AB5959;">++</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 内部函数访问外部变量</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B07D48;">count</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">inner</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">counter</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">outer</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// outer 执行完毕</span></span>
<span class="line"><span style="color:#59873A;">counter</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 1 - 但 count 变量仍然存在</span></span>
<span class="line"><span style="color:#59873A;">counter</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 2</span></span>
<span class="line"><span style="color:#59873A;">counter</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 3</span></span></code></pre></div><h2 id="闭包的核心特性" tabindex="-1">闭包的核心特性 <a class="header-anchor" href="#闭包的核心特性" aria-label="Permalink to &quot;闭包的核心特性&quot;">​</a></h2><ol><li>数据私有化</li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">function</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">createWallet</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">let</span><span style="color:#ADBAC7;"> balance </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;"> </span><span style="color:#768390;">// 私有变量，外部无法直接访问</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">deposit</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">amount</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">      balance </span><span style="color:#F47067;">+=</span><span style="color:#ADBAC7;"> amount</span></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> balance</span></span>
<span class="line"><span style="color:#ADBAC7;">    },</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">withdraw</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">amount</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;"> (amount </span><span style="color:#F47067;">&lt;=</span><span style="color:#ADBAC7;"> balance) {</span></span>
<span class="line"><span style="color:#ADBAC7;">        balance </span><span style="color:#F47067;">-=</span><span style="color:#ADBAC7;"> amount</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> balance</span></span>
<span class="line"><span style="color:#ADBAC7;">      }</span></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Insufficient funds&#39;</span></span>
<span class="line"><span style="color:#ADBAC7;">    },</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">getBalance</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> balance</span></span>
<span class="line"><span style="color:#ADBAC7;">    },</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">myWallet</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">createWallet</span><span style="color:#ADBAC7;">()</span></span>
<span class="line"><span style="color:#ADBAC7;">myWallet.</span><span style="color:#DCBDFB;">deposit</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">100</span><span style="color:#ADBAC7;">) </span><span style="color:#768390;">// 100</span></span>
<span class="line"><span style="color:#ADBAC7;">console.</span><span style="color:#DCBDFB;">log</span><span style="color:#ADBAC7;">(myWallet.balance) </span><span style="color:#768390;">// undefined - 无法直接访问</span></span>
<span class="line"><span style="color:#ADBAC7;">console.</span><span style="color:#DCBDFB;">log</span><span style="color:#ADBAC7;">(myWallet.</span><span style="color:#DCBDFB;">getBalance</span><span style="color:#ADBAC7;">()) </span><span style="color:#768390;">// 100 - 只能通过方法访问</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createWallet</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">let</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">balance</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">0</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 私有变量，外部无法直接访问</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">deposit</span><span style="color:#999999;">(</span><span style="color:#B07D48;">amount</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">balance</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">amount</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">balance</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">withdraw</span><span style="color:#999999;">(</span><span style="color:#B07D48;">amount</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">if</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">amount</span><span style="color:#393A34;"> </span><span style="color:#999999;">&lt;=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">balance</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B07D48;">balance</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-=</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">amount</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">balance</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Insufficient funds</span><span style="color:#B5695999;">&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">getBalance</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">balance</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">myWallet</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">createWallet</span><span style="color:#999999;">()</span></span>
<span class="line"><span style="color:#B07D48;">myWallet</span><span style="color:#999999;">.</span><span style="color:#59873A;">deposit</span><span style="color:#999999;">(</span><span style="color:#2F798A;">100</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 100</span></span>
<span class="line"><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B07D48;">myWallet</span><span style="color:#999999;">.</span><span style="color:#B07D48;">balance</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// undefined - 无法直接访问</span></span>
<span class="line"><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B07D48;">myWallet</span><span style="color:#999999;">.</span><span style="color:#59873A;">getBalance</span><span style="color:#999999;">())</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 100 - 只能通过方法访问</span></span></code></pre></div><ol start="2"><li>状态保持</li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">function</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">makeAdder</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">x</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">function</span><span style="color:#ADBAC7;"> (</span><span style="color:#F69D50;">y</span><span style="color:#ADBAC7;">) {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> x </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> y </span><span style="color:#768390;">// x 被&quot;记住&quot;了</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">add5</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">makeAdder</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">5</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">add10</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">makeAdder</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">10</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">console.</span><span style="color:#DCBDFB;">log</span><span style="color:#ADBAC7;">(</span><span style="color:#DCBDFB;">add5</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">)) </span><span style="color:#768390;">// 7</span></span>
<span class="line"><span style="color:#ADBAC7;">console.</span><span style="color:#DCBDFB;">log</span><span style="color:#ADBAC7;">(</span><span style="color:#DCBDFB;">add10</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">)) </span><span style="color:#768390;">// 12</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">makeAdder</span><span style="color:#999999;">(</span><span style="color:#B07D48;">x</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#999999;">(</span><span style="color:#B07D48;">y</span><span style="color:#999999;">)</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">x</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">y</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// x 被&quot;记住&quot;了</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">add5</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">makeAdder</span><span style="color:#999999;">(</span><span style="color:#2F798A;">5</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">add10</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">makeAdder</span><span style="color:#999999;">(</span><span style="color:#2F798A;">10</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#59873A;">add5</span><span style="color:#999999;">(</span><span style="color:#2F798A;">2</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 7</span></span>
<span class="line"><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#59873A;">add10</span><span style="color:#999999;">(</span><span style="color:#2F798A;">2</span><span style="color:#999999;">))</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 12</span></span></code></pre></div><h2 id="现代前端中的闭包应用" tabindex="-1">现代前端中的闭包应用 <a class="header-anchor" href="#现代前端中的闭包应用" aria-label="Permalink to &quot;现代前端中的闭包应用&quot;">​</a></h2><ol><li>React Hooks（最典型的应用）</li></ol><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#F47067;">function</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">Counter</span><span style="color:#ADBAC7;">() {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> [</span><span style="color:#6CB6FF;">count</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">setCount</span><span style="color:#ADBAC7;">] </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">useState</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">0</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">// 事件处理函数形成闭包，捕获当前的 count 值</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">handleClick</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> () </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">    console.</span><span style="color:#DCBDFB;">log</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;Current count:&#39;</span><span style="color:#ADBAC7;">, count)</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">setCount</span><span style="color:#ADBAC7;">(count </span><span style="color:#F47067;">+</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">1</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">// 闭包陷阱示例</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#DCBDFB;">useEffect</span><span style="color:#ADBAC7;">(() </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">timer</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">setInterval</span><span style="color:#ADBAC7;">(() </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#768390;">// 这里的 count 永远是初始值 0（闭包陷阱）</span></span>
<span class="line"><span style="color:#ADBAC7;">      console.</span><span style="color:#DCBDFB;">log</span><span style="color:#ADBAC7;">(count)</span></span>
<span class="line"><span style="color:#ADBAC7;">    }, </span><span style="color:#6CB6FF;">1000</span><span style="color:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> () </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">clearInterval</span><span style="color:#ADBAC7;">(timer)</span></span>
<span class="line"><span style="color:#ADBAC7;">  }, []) </span><span style="color:#768390;">// 空依赖数组</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> &lt;</span><span style="color:#8DDB8C;">button</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">onClick</span><span style="color:#F47067;">={</span><span style="color:#ADBAC7;">handleClick</span><span style="color:#F47067;">}</span><span style="color:#ADBAC7;">&gt;Count: </span><span style="color:#F47067;">{</span><span style="color:#ADBAC7;">count</span><span style="color:#F47067;">}</span><span style="color:#ADBAC7;">&lt;/</span><span style="color:#8DDB8C;">button</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#AB5959;">function</span><span style="color:#393A34;"> </span><span style="color:#59873A;">Counter</span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#999999;">[</span><span style="color:#B07D48;">count</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">setCount</span><span style="color:#999999;">]</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">useState</span><span style="color:#999999;">(</span><span style="color:#2F798A;">0</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// 事件处理函数形成闭包，捕获当前的 count 值</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#59873A;">handleClick</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B5695999;">&#39;</span><span style="color:#B56959;">Current count:</span><span style="color:#B5695999;">&#39;</span><span style="color:#999999;">,</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">count</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#59873A;">setCount</span><span style="color:#999999;">(</span><span style="color:#B07D48;">count</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">+</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;">  </span><span style="color:#A0ADA0;">// 闭包陷阱示例</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#59873A;">useEffect</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">const</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">timer</span><span style="color:#393A34;"> </span><span style="color:#999999;">=</span><span style="color:#393A34;"> </span><span style="color:#59873A;">setInterval</span><span style="color:#999999;">(()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#999999;">{</span></span>
<span class="line"><span style="color:#999999;">      </span><span style="color:#A0ADA0;">// 这里的 count 永远是初始值 0（闭包陷阱）</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#B07D48;">console</span><span style="color:#999999;">.</span><span style="color:#59873A;">log</span><span style="color:#999999;">(</span><span style="color:#B07D48;">count</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#2F798A;">1000</span><span style="color:#999999;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">()</span><span style="color:#393A34;"> </span><span style="color:#999999;">=&gt;</span><span style="color:#393A34;"> </span><span style="color:#59873A;">clearInterval</span><span style="color:#999999;">(</span><span style="color:#B07D48;">timer</span><span style="color:#999999;">)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#999999;">},</span><span style="color:#393A34;"> </span><span style="color:#999999;">[])</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">// 空依赖数组</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#1E754F;">return</span><span style="color:#393A34;"> </span><span style="color:#999999;">&lt;</span><span style="color:#1E754F;">button</span><span style="color:#393A34;"> </span><span style="color:#B07D48;">onClick</span><span style="color:#999999;">={</span><span style="color:#B07D48;">handleClick</span><span style="color:#999999;">}&gt;</span><span style="color:#393A34;">Count: </span><span style="color:#999999;">{</span><span style="color:#B07D48;">count</span><span style="color:#999999;">}&lt;/</span><span style="color:#1E754F;">button</span><span style="color:#999999;">&gt;</span></span>
<span class="line"><span style="color:#999999;">}</span></span></code></pre></div><p>React 的 useState 使用闭包在内部维护了一个状态存储系统，使得每个组件实例都能独立管理自己的状态。每次重新渲染时，闭包确保 React 记住 count 是更新后的值。</p><p>上面闭包陷阱分析：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark-dimmed vp-code-dark"><code><span class="line"><span style="color:#768390;">// 时间线：</span></span>
<span class="line"><span style="color:#768390;">// t0: 组件首次渲染，count = 0</span></span>
<span class="line"><span style="color:#768390;">//     useEffect 执行，创建定时器，回调函数闭包捕获 count = 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// t1: 用户点击按钮，setCount(1)</span></span>
<span class="line"><span style="color:#768390;">//     组件重新渲染，count = 1</span></span>
<span class="line"><span style="color:#768390;">//     但 useEffect 因为依赖数组为空，不会重新执行</span></span>
<span class="line"><span style="color:#768390;">//     定时器中的回调函数仍然引用着旧的闭包（count = 0）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// t2: 用户点击按钮，setCount(2)</span></span>
<span class="line"><span style="color:#768390;">//     同样，定时器回调仍然看到 count = 0</span></span></code></pre><pre class="shiki vitesse-light vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">// 时间线：</span></span>
<span class="line"><span style="color:#A0ADA0;">// t0: 组件首次渲染，count = 0</span></span>
<span class="line"><span style="color:#A0ADA0;">//     useEffect 执行，创建定时器，回调函数闭包捕获 count = 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// t1: 用户点击按钮，setCount(1)</span></span>
<span class="line"><span style="color:#A0ADA0;">//     组件重新渲染，count = 1</span></span>
<span class="line"><span style="color:#A0ADA0;">//     但 useEffect 因为依赖数组为空，不会重新执行</span></span>
<span class="line"><span style="color:#A0ADA0;">//     定时器中的回调函数仍然引用着旧的闭包（count = 0）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">// t2: 用户点击按钮，setCount(2)</span></span>
<span class="line"><span style="color:#A0ADA0;">//     同样，定时器回调仍然看到 count = 0</span></span></code></pre></div>`,18),e=[o];function c(t,r,y,A,i,B){return n(),a("div",null,e)}const u=s(p,[["render",c]]);export{C as __pageData,u as default};
